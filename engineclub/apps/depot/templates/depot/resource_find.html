{% extends "base.html" %}
{% load utils %}
{% block title %}find resources{% endblock %}
{% block head-extra %}
<script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.8&appid={{ yahoo_appid }}">  
</script>  
<script src="/static/js/jquery-ui.custom.min.js" type="text/javascript"></script>
<link type="text/css" href="/static/js/css/themes/base/jquery.ui.all.css" rel="stylesheet" />
<!-- link type="text/css" href="/static/js/css/demosx.css" rel="stylesheet" / -->
<!-- 
<script type="text/javascript">
$(function() {
    $("#id_tags").autocomplete({
        source: function(request, response) {
            $.ajax({
                url: "/api/tags/",
                dataType: "jsonp",
                data: {
                    match: request.term
                },
                success: function(data) {
                    response($.map(data.data, function(item) {
                        return {
                            label: item,
                            value: item
                        }
                    }))
                }
            })
        },
        minLength: 2,
        open: function() {
            $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
        },
        close: function() {
            $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
        }
    });
});
</script>
<style>
    .ui-autocomplete-loading { background: url(indicator.gif) no-repeat right; }
    #city { width: 25em; }
</style>
 -->
{% endblock %}
{% block main-content-class %}onecol{% endblock %}
{% block content %}
<p><a href="{% url resource-list %}">all items</a></p>

<h1>Find Resources</h1>

<form class="form" action="." method="POST">{% csrf_token %}
    <fieldset>
        <legend><span>Resource details:</span></legend>
        {# <div class="ui-widget"> #}
        
        <ol>
             {{ form.as_ul }}
        </ol>
        {# </div> #}
    </fieldset>

     <fieldset class="submit">
        <input type="submit" name="result" value="Find items">
        <!-- input type="submit" name="result" value="Cancel" -->
    </fieldset>
</form>

<div id="results">
    
  {% if centre %}
    <h2>Closest results for {{ centre.name }}:</h2>
  {% endif %}
    
    <ol class="resource-listing">
    {% for resource in results %}
        <li><p class="resource-listing-title"><a href="{% url resource resource.id %}">{{ resource.title }}</a></p>
            <p>{{ resource.description|truncatewords:30 }}</p>
            <p class="resource-listing-meta"><a class="resource-url" href="{% url resource resource.id %}">more details...</a></p>
            
            
            <!-- div class="more-btn"><a  href="">more details...</a></div -->
        </li>
    {% empty %}
        <li>no results found</li>
    {% endfor %}
    </ol>

</div>
<div id="map"></div>

{% if results and centre %}
<script type="text/javascript">  
    // Create a Map that will be placed in the "map" div.  
    var map = new YMap(document.getElementById('map'));   
    function createCustomMarkerImage(img, larger){  
        var myImage = new YImage();  
        myImage.src = '/static/media/img/'+img;
        if (larger) {
            myImage.size = new YSize(34,36); 
        } else {
            myImage.size = new YSize(30,32);  
        }
        myImage.offsetSmartWindow = new YCoordPoint(0,0);  
        return myImage;   
        }  
    function startMap(){  
        // Add the ability to change between Sat, Hybrid, and Regular Maps  
        map.addTypeControl();     
        // Add the zoom control. Long specifies a Slider versus a "+" and "-" zoom control  
        map.addZoomLong();            
        // Add the Pan control to have North, South, East and West directional control  
        map.addPanControl();    
        // Specifying the Map starting location and zoom level  
        var currentGeoPoint = new YGeoPoint( "{{centre.location.0}}" , "{{centre.location.1}}"  );  
        {# map.addMarker(new YGeoPoint( "{{centre.centroid.latitude}}" , "{{centre.centroid.longitude}}"));   #}
        map.drawZoomAndCenter(currentGeoPoint, 8);

        var newMarker= new YMarker(currentGeoPoint, createCustomMarkerImage('ymarker_bl.png', false));  
        newMarker.addAutoExpand("your location");  
        map.addOverlay(newMarker);

        {% for res in results %}
            {% for loc in res.pt_location %}
            
                pinPoint = new YGeoPoint( "{{loc|get_lat}}" , "{{loc|get_lon}}");  
                var newMarker= new YMarker(pinPoint, createCustomMarkerImage('ymarker_or.png', false));  
                newMarker.addAutoExpand('<p><a href="{% url resource res.id %}">{{ res.title }}</a></p>');
            
                map.addOverlay(newMarker);
            {% endfor %}
        {% endfor %}
    }  
window.onload = startMap;     
</script>  
{% endif %}

{% endblock %}

