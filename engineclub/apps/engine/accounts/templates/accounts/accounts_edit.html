{% extends "accounts/accounts_base.html" %}
{% load url from future %}

{% block title %}{% if new %}New group{% else %}Edit {{ form.instance.name }}{% endif %}{% endblock %}

{% block breadcrumbs %}
<ul class="breadcrumbs">
    <li><a href="{% url 'accounts' %}">Browse Aliss users</a></li>
    <li><a href="{% url 'accounts_find' %}">Search Aliss users</a></li>
    <li><a href="{% url 'accounts_detail' object.id %}">{{ object.name }}</a></li>
    <li class="current"><a href="#">Edit</a></li>
</ul>
{% endblock %}

{% block content %}

 
<h1>{% if new %}New group{% else %}Edit: {{ form.instance.name }}{% endif %}</h1>

<form method="post" action=".">{% csrf_token %}
    {{ form.as_p }}
    
    {% if locationform %}
        <fieldset>
            <legend><span>Locations:</span></legend>
            {{ locationform.as_plain }}
        </fieldset>
    {% endif %}

    <input type="submit" value="Submit" id="" />
</form>


{% endblock %}

{% block script-extra %}
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/themes/base/jquery-ui.css" type="text/css" rel="stylesheet">
<link href="/static/css/token-input-aliss.css" type="text/css" rel="stylesheet">

 <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js" type="text/javascript"></script>
<script src="/static/js/jquery.tokeninput.js" type="text/javascript"></script>
{% endblock script-extra %}
{% block document-ready %}
$('#new_location_submit').replaceWith('<a href="#" class="add-link" id="new_location_link">add location</a>');
//$('#new_location_link').click(function() {alert('blah');});
$('#new_location_link').click(function() {$('#main-form').submit();});
$(".datepicker").datepicker({ dateFormat: 'dd/mm/yy' });

$('#id_tags').tokenInput('{% url 'resources.api_handlers.tags' %}', {
    minChars: 3,
    onResult: function (results) {
        var typedValue = $('#token-input-id_tags').val();
        var r = [{id: typedValue, name: typedValue + ' (new)'}];
        $.each(results.data, function (i, item) {
            r.push({id: item, name: item});
        });
        return r;
    },
    prePopulate: [{% for t in object.tags %}{id: "{{ t|safe }}", name: "{{ t|safe }}"}{% if not forloop.last %},{% endif %}{% endfor %}],
    queryParam: 'match',
    theme: 'aliss'
});
{% if locationform %}
    $('#id_new_location').tokenInput('{% url 'resources.api_handlers.locations' %}', {
        minChars: 3,
        onResult: function (results) {
            var typedValue = $('#token-input-id_new_location').val();
            var r = [{id: typedValue, name: typedValue + ' (new)'}];
            //var r = [];
            $.each(results.data, function (i, item) {
                r.push({id: item.id, name: (item.postcode) ? 
                    (item.postcode + ', ' + item.place_name) : 
                    (item.place_name + ', ' + item.district)});
            });
            return r;
        },
        prePopulate: [{% for l in object.locations %}{id: '{{ l.id }}', name: '{{ l }}'}{% if not forloop.last %},{% endif %}{% endfor %}],
        queryParam: 'match',
        theme: 'aliss'
    });
{% endif %}
{% endblock document-ready %}
