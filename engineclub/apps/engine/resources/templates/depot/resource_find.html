{% extends "depot/resource_base.html" %}

{% load utils depot_tags markup %}
{% load url from future %}

{% block title %}find resources{% endblock %}

{% block body_class %}search resource{% endblock %}

{% block breadcrumbs %}
<ul class="breadcrumbs">
    <li class="current"><a href="#">Search Aliss resources</a></li>
</ul>
{% endblock %}

{% block content %}

{% if user.is_authenticated %}
<dl class="sub-nav">
    <dt>Actions:</dt>
    <dd><a href="{% url 'resource_add' %}">Add a new resource</a></dd>
    {% if user.is_staff %}
        <dd><a href="{% url 'cab_reindex' %}" id="reindex">Reindex resources</a></dd>
    {% endif %}
</dl>

<div id="loading">working...</div>

{% endif %}

    <h1>Search Aliss resources</h1>

    <div class="row">

        <div class="search-form{% if not show_map %}-full{% endif %}">
            <form class="nice form" action="." method="GET" id="search_form">{% csrf_token %}
                <fieldset>
                    <legend><span>Type in a place, post code, or words:</span></legend>

                    {{ form.as_plain }}

                    <input type="submit" name="result" value="Find items" id="submit_button">
                </fieldset>
            </form>

        </div>      
    {% if results and centre %}<div id="map"></div>{% endif %}
    </div>

    <div class="row results">

        <ul class="resource-listing">
            {% for result in results %}
                {% with result.resource_result as resource %}

                    <li>
                        <div class="row">
                        <h3><a href="{% url 'resource' object_id=resource.res_id %}">{{ resource.title }}</a></h3>
                        {% if resource.event_start %} 
                            <p class="event">{{ resource|idx_event_start }}{% if resource.event_end %} - {{ resource|idx_event_end }}{% endif %}</p>
                        {% endif %}
                        <div class="location">
                        {% if resource.loc_labels %}
                            <h4>Location:</h4>
                            {% for loc_label in resource.loc_labels %}
                                <p>{{ loc_label }}</p>
                            {% endfor %}
                        {% endif %}
                        </div>
                        {{ resource.short_description|truncatewords:30|textile }}
                        <p><a href="#top" class="action top">top</a></p>
                        </div>
                    </li>
                {% endwith %}
            {% empty %}
                {% if not new_search %} 
                    <li>no results found for your area of interest. Would you like to <a href="{% url 'contact' %}">help us create some</a>?</li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>

{% endblock %}

{% block script-extra %}
<script type="text/javascript" src="http://maps.google.com/maps?file=api&v=2&key={{ google_key }}"></script>
<script type="text/javascript" charset="utf-8" src="/static/js/mxn-min.js"></script>
<script type="text/javascript" charset="utf-8" src="/static/js/mxn.core-min.js"></script>
<script type="text/javascript" charset="utf-8" src="/static/js/mxn.google.core-min.js"></script>

{% endblock script-extra %}

{% block document-ready %}{% include 'depot/resource_find_map_js.html' with res_type='resource' rev_url='resource' %}{% endblock document-ready %}

